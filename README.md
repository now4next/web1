# AI 역량 진단 플랫폼

AI 기술을 활용한 지능형 역량 진단 및 개발 지원 플랫폼입니다.

## 🎯 프로젝트 개요

조직의 역량 모델을 기반으로 맞춤형 진단을 자동 생성하고, 진단 결과를 분석하여 실행 지원까지 제공하는 통합 플랫폼입니다.

## 🌐 데모 URL

- **프로덕션 배포**: https://aiassess.pages.dev
- **최신 배포 (v0.5.5)**: https://cb24e768.aiassess.pages.dev ✅ (채팅 UI 레이아웃 수정)
- **GitHub 레포지토리**: https://github.com/now4next/web1
- **상태**: 🟢 Live (D1 Database + OpenAI API + 회원별 AI 대화 관리 + 세션 인증)

## ✅ 현재 구현된 기능

### Phase 1: ASSESS (진단 설계 및 실행) ✅
- ✅ **역량 키워드 검색 및 선택**: 조직의 역량 모델에서 키워드 검색
  - **NEW v0.5.2!** 직무명(job_name) 검색 지원 - "영업", "마케팅", "인사" 등으로 검색 가능
  - 역량명, 역량정의, 직무명에서 포괄 검색
- ✅ **AI 문항 자동 생성 및 관리**: OpenAI GPT-4o-mini를 활용한 진단 문항 생성 (데모 모드 지원)
  - 행동 지표 (Behavioral Indicators) 자동 생성
  - 역량별 진단 문항 자동 생성
  - 진단 안내문 자동 생성
  - **NEW!** 생성된 문항 DB 자동 저장
  - **NEW!** 저장된 문항 우선 로드 (재사용)
  - **NEW!** "AI 문항 추가 생성" 버튼으로 추가 생성
  - **NEW!** 기존 문항과 신규 문항 자동 병합
  - API 키 없이도 데모 모드로 테스트 가능
- ✅ **진단 유형 선택**: 자가진단, 다면평가, 설문조사
- ✅ **대상 직급 맞춤화**: 직급별 맞춤형 문항 생성

### Phase 2: ANALYTICS (분석 및 인사이트) ✅
- ✅ **개인별 분석 리포트**: 응답자별 종합 역량 분석 웹 리포트
  - 역량별 통계 분석 (평균, 최대/최소, 표준편차)
  - 강점 영역 및 개선 필요 영역 자동 식별
  - Chart.js 기반 역량 점수 시각화 (색상 코딩)
  - 역량별 상세 점수 및 질문별 응답 확인
- ✅ **AI 인사이트 생성 및 관리**: OpenAI GPT-4o-mini 기반 맞춤형 피드백
  - 전반적 평가: 종합 역량 수준 판단
  - 주요 강점: 우수한 역량 분석
  - 개선 필요 영역: 보완이 필요한 부분
  - 발전 방향 추천: 구체적 실행 계획 제안
  - **NEW!** 인사이트 자동 저장 및 로드 (D1 Database)
  - **NEW!** 재생성 버튼으로 인사이트 업데이트
  - **NEW!** 저장된 인사이트 지속적 표시
- ⏳ 전사 현황 모니터링 대시보드 (향후 개발)

### Phase 3: ACTION (실행 지원) ✅
- ✅ **4가지 AI 어시스턴트 시스템**: 역량 개발을 위한 맞춤형 AI 지원
  - **AI 컨설팅**: 전략적 관점에서 조직 역량 개발 방향 제시 (파란색)
  - **AI 코칭**: 질문을 통해 스스로 답을 찾도록 돕는 역량 개발 코치 (초록색)
  - **AI 멘토링**: 실무 경험을 바탕으로 한 조언과 가이드 제공 (보라색)
  - **AI 티칭**: 체계적이고 명확한 교육 및 학습 지원 (주황색)
- ✅ **세련된 채팅 UI**: 
  - **NEW!** 고급스러운 헤더 디자인 (그라디언트, 온라인 상태 표시)
  - **NEW!** 현대적인 메시지 버블 (꼬리 효과, 읽음 표시)
  - **NEW!** 부드러운 애니메이션과 호버 효과
  - **NEW!** 세련된 입력 영역 (포커스 링, 그라디언트 버튼)
  - **NEW!** 개선된 타이핑 인디케이터 (그라디언트 점, 애니메이션)
  - 4개 어시스턴트 선택 카드 (전문적 디자인)
  - 대화 리셋 기능
- ✅ **회원별 대화 내용 지속성**:
  - **NEW!** 로그인 회원 기준 대화 저장 및 관리
  - **NEW!** 어시스턴트별 독립적인 대화 히스토리
  - **NEW!** 로그인 시 이전 대화 자동 로드
  - **NEW!** 대화 내용 실시간 저장 (자동)
  - **NEW!** 세션 인증을 통한 보안 강화
  - **NEW!** 마지막 업데이트 시간 표시
  - **NEW!** 로그인 필수 (비로그인 시 로그인 모달)
- ✅ **각 어시스턴트 고유 특성**:
  - 독특한 시스템 프롬프트와 성격
  - 맞춤형 인사말과 대화 스타일
  - 색상으로 구분된 UI

## 📊 데이터 아키텍처

### 데이터베이스: Cloudflare D1 (SQLite)

**주요 테이블:**
- `competency_models`: 역량 모델 (공통/리더십/직무)
- `competencies`: 역량 키워드
- `behavioral_indicators`: 행동 지표
- `assessment_questions`: 진단 문항
- `assessment_sessions`: 진단 세션
- `respondents`: 응답자 정보
- `assessment_responses`: 진단 응답 데이터
- `analysis_results`: 분석 결과
- `coaching_sessions`: AI 코칭 세션 기록

### 저장 서비스
- **Cloudflare D1**: 관계형 데이터 저장
- **Cloudflare KV**: (향후) 캐시 및 세션 관리
- **Cloudflare R2**: (향후) 리포트 파일 저장

## 🔧 기술 스택

- **Backend**: Hono (TypeScript)
- **Frontend**: Vanilla JavaScript + TailwindCSS
- **Database**: Cloudflare D1 (SQLite)
- **AI**: OpenAI GPT-4o-mini API
- **Deployment**: Cloudflare Pages/Workers
- **Development**: Wrangler, PM2

## 🚀 로컬 개발 환경 설정

### 1. 환경 변수 설정 (선택사항)

**데모 모드**: OpenAI API 키 없이도 모든 기능을 테스트할 수 있습니다!

실제 AI 생성을 원하시면 `.dev.vars` 파일에 OpenAI API 키를 설정하세요:

```bash
OPENAI_API_KEY=sk-your-openai-api-key-here
```

API 키가 없으면 자동으로 데모 모드로 실행되어 샘플 데이터를 표시합니다.

### 2. 의존성 설치

```bash
npm install
```

### 3. 데이터베이스 마이그레이션 및 시드

```bash
# 로컬 D1 데이터베이스 마이그레이션
npm run db:migrate:local

# 샘플 데이터 삽입
npm run db:seed
```

### 4. 개발 서버 시작

```bash
# 빌드
npm run build

# PM2로 개발 서버 시작
pm2 start ecosystem.config.cjs

# 또는 직접 실행
npm run dev:sandbox
```

서버는 `http://localhost:3000`에서 실행됩니다.

## 📡 API 엔드포인트

### 역량 관리
- `GET /api/competency-models` - 역량 모델 목록
- `POST /api/competency-models` - 역량 모델 생성
- `GET /api/competencies/search?q={keyword}` - 역량 검색 (역량명, 역량정의, 직무명 검색)
- `GET /api/competencies/:modelId` - 특정 모델의 역량 목록
- `POST /api/competencies` - 역량 추가

### AI 기능
- `POST /api/ai/generate-questions` - AI 문항 생성
  ```json
  {
    "competency_keywords": ["커뮤니케이션", "리더십"],
    "target_level": "manager",
    "question_type": "self"
  }
  ```
- `POST /api/ai/coaching` - AI 코칭 대화
  ```json
  {
    "messages": [
      {"role": "system", "content": "..."},
      {"role": "user", "content": "..."}
    ]
  }
  ```

### 분석 및 인사이트
- `GET /api/respondents` - 응답자 목록 조회
- `GET /api/analysis/:respondentId` - 개인별 역량 분석 리포트
  ```json
  {
    "success": true,
    "data": {
      "respondent": { "id": 1, "name": "김철수", ... },
      "analysis": [
        {
          "competency": "커뮤니케이션",
          "average": 4.4,
          "max": 5,
          "min": 4,
          "stdDev": 0.49,
          "questions": [...]
        }
      ],
      "summary": {
        "overallAverage": 3.87,
        "strengths": ["커뮤니케이션", "전략적 사고"],
        "improvements": ["변화 관리", "문제 해결"]
      }
    }
  }
  ```
- `POST /api/analysis/:respondentId/insights` - AI 인사이트 생성
  ```json
  {
    "insights": {
      "overall": "전반적 평가 텍스트",
      "strengths": "강점 분석 텍스트",
      "improvements": "개선 영역 분석 텍스트",
      "recommendations": "발전 방향 제안 텍스트"
    }
  }
  ```

### 진단 관리
- `GET /api/assessment-sessions` - 진단 세션 목록
- `POST /api/assessment-sessions` - 진단 세션 생성
- `GET /api/respondents` - 응답자 목록
- `POST /api/respondents` - 응답자 등록

## 📝 사용 가이드

### 1. 역량 키워드 선택
- "진단 설계" 탭에서 역량 키워드 또는 직무명을 검색합니다
- **역량명 검색**: "커뮤니케이션", "리더십", "전략적사고"
- **직무명 검색 (NEW v0.5.2!)**: "영업", "마케팅", "인사", "재무" 등
- 검색 결과에서 필요한 역량을 선택합니다

### 2. AI 문항 생성
- 대상 직급 선택 (전체/사원·대리/과장·차장/팀장 이상)
- 진단 유형 선택 (자가진단/다면평가/설문조사)
- "AI 문항 생성" 버튼 클릭
- AI가 자동으로 행동 지표와 진단 문항을 생성합니다
- ⚙️ **데모 모드**: OpenAI API 키가 없어도 샘플 문항을 바로 확인할 수 있습니다

### 3. 분석 리포트 확인
- "분석 및 인사이트" 탭으로 이동
- 응답자 목록에서 분석할 응답자를 선택합니다
- 개인별 종합 분석 리포트를 확인합니다:
  - 📊 역량별 점수 차트 (Chart.js 시각화)
  - 💪 강점 영역 (상위 1/3)
  - 📈 개선 필요 영역 (하위 1/3)
  - 📋 역량별 상세 점수 및 질문별 응답
  - 🤖 AI 생성 인사이트 (전반적 평가, 강점, 개선사항, 발전 방향)
- ⚙️ **데모 모드**: OpenAI API 키가 없어도 샘플 인사이트를 확인할 수 있습니다

### 4. AI 어시스턴트 활용
- "실행 지원" 탭으로 이동
- 4가지 AI 어시스턴트 중 하나를 선택합니다:
  - **AI 컨설팅** 💼: 조직 차원의 전략적 역량 개발 방향
  - **AI 코칭** 🎯: 질문 기반 자기주도적 성장 지원
  - **AI 멘토링** 🤝: 경험 기반 실무 조언과 가이드
  - **AI 티칭** 📚: 체계적인 학습 및 교육 지원
- 선택한 어시스턴트와 대화를 시작합니다
- 강점 강화 및 약점 보완 방안을 상담받을 수 있습니다
- ⚙️ **데모 모드**: OpenAI API 키가 없어도 샘플 응답으로 체험할 수 있습니다

## 🎨 샘플 데이터

프로젝트에는 다음 샘플 데이터가 포함되어 있습니다:

### 역량 모델
- 공통 역량 (전 직원 대상)
- 리더십 역량 (관리자 이상)
- 전략기획 직무역량 (전문가)

### 역량 키워드

**기존 샘플 역량:**
- 커뮤니케이션, 문제해결, 협업, 학습민첩성
- 전략적사고, 변화관리, 코칭, 의사결정
- 데이터분석, 사업기획, 시장분석

**NEW! NCS 기반 직무 전문 역량 (80+ 역량):**
- **직업기초능력 (10개)**: 의사소통능력, 수리능력, 문제해결능력, 자기개발능력, 자원관리능력, 대인관계능력, 정보능력, 기술능력, 조직이해능력, 직업윤리
- **정보통신 (7개)**: 응용SW개발, 시스템SW개발, 데이터베이스, 네트워크구축, 정보보안, 빅데이터, 인공지능
- **경영·회계·사무 (6개)**: 전략기획, 재무회계, 세무, 인사관리, 노무관리, 총무
- **마케팅 (4개)**: 시장조사, 브랜드관리, 디지털마케팅, 광고기획
- **데이터분석 (4개)**: 데이터 수집, 데이터 시각화, 통계분석, 머신러닝
- **IT프로젝트관리 (4개)**: IT 프로젝트 기획, IT 요구사항 분석, IT 테스트 관리, IT 서비스 운영
- **금융·보험 (4개)**: 여신관리, 자산운용, 보험상품개발, 리스크관리
- **건설 (4개)**: 건축설계, 토목설계, 건설시공관리, 적산
- **기계 (4개)**: 기계설계, 기계가공, 금형설계, 설비보전
- **전기·전자 (4개)**: 전기설비설계, 전자회로설계, 반도체제조, 임베디드시스템
- **보건·의료 (4개)**: 진단검사, 환자관리, 의료정보관리, 보건교육
- **문화·예술·디자인·방송 (4개)**: 시각디자인, 영상제작, 콘텐츠 기획, UX/UI 디자인
- **영업판매 (4개)**: 고객관계관리, 제안영업, 유통관리, 매장관리
- **사업관리 (4개)**: 프로젝트 관리, 사업기획, 품질관리, 생산관리
- **교육·자연·사회과학 (4개)**: 교수설계, 교육훈련운영, 연구개발, 통계분석
- **환경·에너지·안전 (4개)**: 환경관리, 신재생에너지, 산업안전, 소방
- **화학·바이오 (3개)**: 화학제품제조, 바이오실험, 의약품제조
- **사회복지·종교 (3개)**: 사례관리, 프로그램 개발, 상담

출처: [국가직무능력표준(NCS)](https://www.ncs.go.kr/th04/dutyCompeDgn.do)

## 🔮 향후 개발 계획

### Phase 2 완성 (우선순위: 높음)
- [x] 진단 응답 데이터베이스 설계 및 구축
- [x] 기본 통계 분석 엔진 (평균, 표준편차, 최대/최소)
- [x] AI 기반 정성적 인사이트 생성 (OpenAI GPT-4o-mini)
- [x] 개인별 분석 리포트 시각화 (Chart.js)
- [ ] 진단 응답 수집 UI (응답자용 진단 화면)
- [ ] 전사 현황 모니터링 대시보드 (조직 전체 분석)

### Phase 3 확장 (우선순위: 중간)
- [x] 4가지 AI 어시스턴트 시스템 (컨설팅, 코칭, 멘토링, 티칭)
- [x] 현대적인 채팅 UI (선택 카드, 메시지 버블, 타이핑 인디케이터)
- [ ] 학습 콘텐츠 검색 및 추천
- [ ] 역량 개발 로드맵 자동 생성

### 추가 기능 (우선순위: 낮음)
- [ ] 사용자 인증 및 권한 관리
- [ ] PDF 리포트 생성
- [ ] 이메일 알림
- [ ] 다국어 지원

## ⚠️ 제약사항 (Cloudflare Pages 한계)

현재 구현은 Cloudflare Pages/Workers 환경에 최적화되어 있습니다:

- ✅ **가능한 것**: 
  - 간단한 통계 분석 (평균, 표준편차, 백분위)
  - OpenAI API를 통한 AI 기능
  - D1 데이터베이스 기본 쿼리
  - 실시간 대화형 코칭

- ❌ **불가능한 것**:
  - 복잡한 통계 분석 (상관분석, 회귀분석, 요인분석)
  - Python 기반 ML 모델 실행
  - 대용량 파일 처리
  - 장시간 실행되는 백그라운드 작업

## 🔐 보안 고려사항

- **API 키 관리**: 
  - 로컬: `.dev.vars` 파일 사용 (git에 커밋되지 않음)
  - 프로덕션: `wrangler secret put` 명령으로 안전하게 관리
- **데이터 보안**: D1 데이터베이스는 Cloudflare 네트워크 내에서 보호됨
- **CORS 설정**: API 엔드포인트에만 CORS 활성화

## 🐛 문제 해결

### OpenAI API 키 관련
**Q: OpenAI API 키가 없어도 사용할 수 있나요?**  
A: 네! 모든 AI 기능이 데모 모드를 지원합니다. API 키 없이도 샘플 데이터로 전체 기능을 체험할 수 있습니다.

**Q: 실제 AI 생성을 사용하고 싶어요**  
A: `.dev.vars` 파일에 유효한 `OPENAI_API_KEY`를 설정하면 실제 GPT-4o-mini로 문항 생성과 코칭이 작동합니다.

### 데이터베이스 오류
```
Error: no such table: competency_models
```
→ `npm run db:migrate:local`을 실행하여 마이그레이션을 적용하세요.

### 포트 충돌
```
Error: Port 3000 is already in use
```
→ `npm run clean-port` 또는 `fuser -k 3000/tcp`로 포트를 정리하세요.

## 📄 라이센스

This project is for demonstration purposes.

## 👥 기여

기여는 언제나 환영합니다! PR을 보내주세요.

## 📧 문의

프로젝트 관련 문의사항이 있으시면 이슈를 등록해주세요.

---

**마지막 업데이트**: 2025-11-11  
**현재 버전**: 0.5.5 (회원별 대화 지속성 구현 완료)  
**개발 상태**: ✅ Active Development  
**배포 상태**: 🚀 Deployed on Cloudflare Pages

### 최신 업데이트 (v0.5.5) 👥
- ✅ **회원별 AI 대화 지속성 구현**
  - 로그인 회원 기준으로 대화 저장 및 관리
  - `coaching_sessions` 테이블에 `user_id`, `assistant_type` 컬럼 추가
  - 어시스턴트별 독립적인 대화 히스토리 유지
  - 로그인 시 이전 대화 자동 로드 및 이어가기
  - 세션 인증을 통한 보안 강화 (Authorization 헤더)
  - 대화 내용 실시간 자동 저장
  - 비로그인 사용자는 로그인 모달 표시
  - UPDATE/INSERT 로직으로 중복 방지
  - 각 사용자는 4가지 어시스턴트별로 독립적인 대화 유지

### 이전 업데이트 (v0.5.4) ✨
- ✅ **채팅 인터페이스 UI 세련화**
  - 고급스러운 헤더 디자인 (그라디언트 배경, 온라인 상태 표시)
  - 현대적인 메시지 버블 (꼬리 효과, 메시지 방향별 디자인)
  - 부드러운 페이드인 애니메이션 및 스케일 호버 효과
  - 세련된 입력 영역 (포커스 링, 그라디언트 전송 버튼)
  - 개선된 타이핑 인디케이터 (그라디언트 점, 부드러운 바운스)
  - 읽음 표시 및 타임스탬프 디자인 개선
  - 배경 패턴 및 시각적 계층 구조 향상
  - 어시스턴트 선택 카드와 일관된 디자인 언어

### 이전 업데이트 (v0.5.3) 🎯
- ✅ **FOREIGN_KEY_ERROR 근본 원인 해결**
  - AI가 생성한 역량 키워드를 DB 키워드와 강제 일치
  - OpenAI 프롬프트 개선 - 정확한 키워드 사용 명령 추가
  - Backend 역량명 정규화 로직 추가 (case-insensitive + trim)
  - 진단 제출 실패 문제 완전 해결
  - 이중 안전장치로 데이터 일관성 보장
  - 📄 상세 문서: `FIX_SUMMARY.md`

### 이전 업데이트 (v0.5.2) ⭐
- ✅ **직무명(job_name) 검색 기능 추가**
  - `competencies` 테이블에 `job_name` 컬럼 추가
  - 검색 API 업데이트 - 역량명, 역량정의, 직무명 통합 검색
  - 15개 직무 카테고리 지원 (영업, 마케팅, 인사, 재무, 법무, 정보기술 등)
  - 직무명으로 관련 역량 일괄 검색 가능
  - 예: "영업" 검색 → 관계형성, 서비스 지향, 성과지향
  - 검색 성능 최적화 (인덱스 추가)
  - ⚠️ **프로덕션 DB 마이그레이션 대기**: Cloudflare D1 Console에서 수동 적용 필요
  - 📄 마이그레이션 가이드: `PRODUCTION_MIGRATION_GUIDE.md`

### 이전 업데이트 (v0.5.1)
- ✅ **진단 문항 디스플레이 설정 UI 개선**
  - 드롭다운에서 버튼 박스 방식으로 변경
  - 1개~10개, 전체 선택 버튼 11개 제공
  - 선택 시 파란색 테두리/배경으로 활성화 표시
  - hover 효과로 사용성 향상
  - 반응형 그리드 레이아웃 (모바일 6칸, 데스크탑 11칸)
  - 직관적인 UI/UX로 선택 경험 개선

### 이전 업데이트 (v0.5.0)
- ✅ **AI 어시스턴트 대화 히스토리 관리**
  - 대화 내용 자동 저장 (D1 Database)
  - 어시스턴트 재선택 시 이전 대화 자동 로드
  - 대화 연속성 유지 (컨텍스트 보존)
  - 마지막 업데이트 시간 표시
  - 어시스턴트별 독립적 대화 관리
  - 세션 간 대화 이어가기 가능

### 이전 업데이트 (v0.4.0)
- ✅ **진단 문항 재사용 시스템**
  - 생성된 행동지표와 진단문항을 D1 데이터베이스에 자동 저장
  - 동일 역량 선택 시 저장된 문항 우선 표시
  - "AI 문항 추가 생성" 버튼으로 추가 문항 생성 가능
  - 기존 문항과 신규 문항 자동 병합
  - 역량별 문항 라이브러리 구축
  - 문항 생성 비용 절감 및 일관성 향상

### 이전 업데이트 (v0.3.1)
- ✅ **AI 인사이트 지속성 개선**
  - 생성된 인사이트를 D1 데이터베이스에 자동 저장
  - 페이지 로드 시 저장된 인사이트 자동 표시
  - 재생성 버튼으로 언제든 업데이트 가능
  - 저장 상태 뱃지 표시 (캐시됨/데모 모드)
  - 사용자 경험 대폭 개선 (인사이트 유지)

### 이전 업데이트 (v0.3.0)
- ✅ Phase 3 Action 완성 - 4가지 AI 어시스턴트 시스템
  - AI 컨설팅, 코칭, 멘토링, 티칭 (각각 고유 성격)
  - 현대적인 채팅 UI (선택 카드, 메시지 버블, 애니메이션)
  - 타이핑 인디케이터, 타임스탬프, 대화 리셋 기능
- ✅ 역량 차트 개선
  - 수평 바 차트로 변경 (가독성 향상)
  - 색상 코딩 (높음: 초록, 보통: 노랑, 낮음: 빨강)
  - 향상된 툴팁 및 레이블
- ✅ Cloudflare Pages 프로덕션 배포
  - GitHub 레포지토리 연동
  - 자동 배포 파이프라인 구축
- ✅ 이전 업데이트 (v0.2.0)
  - Phase 2 Analytics 핵심 기능 완료
  - AI 인사이트 생성 (강점/개선 영역 분석)
  - NCS 기반 직무 전문 역량 80+ 추가
